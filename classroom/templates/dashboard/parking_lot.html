{% block content %}
<h2>Parking Lot</h2>
{% if user_vehicle %}
    <p>You have parked at: {{ user_vehicle.parking_spot.name }}</p>
{% else %}
    <p>You have not parked yet.</p>
{% endif %}

<div id="parking-container">
  {% for location in locations %}
      <div class="parking-spot">
          <h3>{{ location.name }}</h3>
          <p>Status: <span id="status-{{ location.id }}">{{ location.status }}</span></p>
          {% if location.section == "Available" %}
              <button class="park-here-btn" data-location="{{ location.id }}">Park Here</button>
          {% else %}
              <button enabled>Occupied</button>
          {% endif %}
      </div>
  {% endfor %}
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".park-here-btn").forEach(button => {
          button.addEventListener("click", function () {
              let locationId = this.getAttribute("data-location");
  
              fetch("{% url 'park_vehicle' %}", {
                  method: "POST",
                  headers: {
                      "Content-Type": "application/x-www-form-urlencoded",
                      "X-CSRFToken": "{{ csrf_token }}"
                  },
                  body: "location_id=" + locationId
              })
              .then(response => response.json())
              .then(data => {
                  if (data.message) {
                      alert(data.message);
                      document.getElementById("status-" + locationId).innerText = "Occupied";
                      location.reload();
                  } else {
                      alert("Error: " + data.error);
                  }
              })
              .catch(error => console.error("Error:", error));
          });
      });
  });
  </script>
{% endblock %}
